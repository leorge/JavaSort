#!/bin/sh
LANG=C
if [ $# -lt 1 ]; then
    echo "usage : $0  log2(N)  [repeat]"
    exit
fi
log2N=$1; shift     # log2(N)
if [ $log2N -lt 20 ]; then log2N=20; fi
if [ $# -gt 0 ]; then
    repeat=$1; shift
    if [ $repeat -le 0 ]; then repeat=1; fi
fi

sed -i -e '1,/^@/!d' $0     # Delete data part
echo "start    : `date -u`" >> $0       # add date
echo "computer : `uname -norpv`" >> $0
echo "operator : `id -un`" >> $0
echo "option   : $log2N ${repeat:=1}" >> $0

#
# search boundary between the middle and median of several elements
#
#    l : quicksort - java.util.Arrays.sort()
#    h : quicksort - The simplest quicksort with a pivot Hole
#    a : quicksort - Asymmetric Quicksort
#   -d : Max. N of choice the middle element (63).
#   -P : Max. N to choose the median-of-3 (127)
#

N=`echo 2^$log2N | bc`
for i in `seq 1 $repeat`; do echo "$0 $i `date`" > /dev/stderr
    ./random.awk $N > data
    for j in `seq 1 20`; do echo "$i:$j"  | tee /dev/stderr
        k=`echo 2^$j | bc`
        ./jsort -N $N lha -d $k -3 $N data | sed 's/AsymmetricQuicksort/median-of-3/'
        ./jsort -N $N   a -d  1 -3 $k data | sed 's/AsymmetricQuicksort/median-of-5/'
    done
done > tmp$$
echo "stop     : `date -u`" >> $0       # add date

OUT=tmp.`basename $0`
./et.awk -v 'x=log2(threshold)' tmp$$ > $OUT
expand -t `./col.awk $OUT` $OUT | tee -a $0
echo "Raw data is in a file tmp$$"

exit

@
start    : Fri Jul  1 22:31:39 UTC 2016
computer : Phenom 3.13.0-91-generic #138-Ubuntu SMP Fri Jun 24 17:00:34 UTC 2016 x86_64 GNU/Linux
operator : leo
option   : 20 1
